{% extends "base.html" %}
{% block contend %}
{% load static %}
{% csrf_token %}

<input type="text" id="idPart" value="{{part.num_parte_pk}}" hidden>

<div class="page__equipment">

    <div class="page__equipment-section-info">
        <div class="container--equipment">
            <div class="container__section-image">
                <div class="container__image-selector">
                    <!-- Aquí se muestra la imagen seleccionada -->
                    <img id="image-display" class="container__image--equipment" 
                         src="{% if part.imagen_1 %}{{ part.imagen_1.url }}{% else %}{{ default_image }}{% endif %}" 
                         alt="img">
                    
                    <div class="image-selector__options">
                        <div class="button button--edit button--input">
                            {% if user.groups.first.name == 'administrators' %}
                                <label class="custom-file-upload pointer" for="equipmentFileImageInput">
                                    Seleccionar archivo
                                    <input id="equipmentFileImageInput" class="file-upload" type="file" accept=".jpg, .jpeg, .png, .webp"
                                        data-app="partsInventory"
                                        data-table="inventario"
                                        data-field="imagen_1"
                                        data-type="image"
                                        data-record="{{part.num_parte_pk}}">
                                </label>
                            {% endif %}
                        </div>


                        <div>
                            <a id="expandedImage">
                                <svg class="svg-option" fill="currentColor" viewBox="-50 -50 589.001 589.001">
                                    <g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                    <g id="SVGRepo_iconCarrier"> <g> <g> <path d="M2.2,168.151l-2.1-151.3c-0.1-7.7,6.2-14,13.9-13.9l151.3,2.2c12.1,0.2,18.1,14.8,9.5,23.4l-42.1,42.1l70,70l-65,65 l-70-70l-42.1,42.1C17.1,186.251,2.4,180.251,2.2,168.151z"></path> 
                                    <path d="M421.3,136.551l42.1,42.1c8.6,8.6,23.2,2.6,23.4-9.5l2.2-151.3c0.1-7.7-6.2-14-13.9-13.9l-151.3,2.2 c-12.1,0.2-18.1,14.8-9.5,23.4l42,41.9l-70,70l65,65L421.3,136.551z"></path>
                                    <path d="M314.2,460.451c-8.6,8.6-2.6,23.2,9.5,23.4l151.3,2.2c7.7,0.1,14-6.2,13.9-13.9l-2.2-151.3c-0.2-12.1-14.8-18.1-23.4-9.5 l-42.1,42.1l-70-70l-65,65l70,70L314.2,460.451z"></path> 
                                    <path d="M14,485.051l151.3-2.2c12.1-0.2,18.1-14.8,9.5-23.4l-42.1-42l70-70l-65-65l-70,70l-42.1-42.1c-8.6-8.6-23.2-2.6-23.4,9.5 L0,471.151C0,478.851,6.3,485.151,14,485.051z"></path> </g> </g> </g>
                                </svg>
                            </a>

                            <div class="modal-image" id="modalImage">
                                <span class="modal-image__close">&times;</span>
                                <div class="modal-image__content">
                                    <img class="modal-image__image" id="imageModal">
                                </div>
                                <!-- Botones para el carrusel -->
                                <a class="modal-image__button modal-image__button--prev">&#10094;</a>
                                <a class="modal-image__button modal-image__button--next">&#10095;</a>
                            </div>


                            <a id="downloadFileEquipment">
                                <svg class="svg-option" fill="currentColor" viewBox="0 2 23 29" version="1.1" >
                                    <path d="M18.313 13.625h-4.031v-6.594c0-0.563-0.469-1.031-1.031-1.031h-4.031c-0.594 0-1.063 0.469-1.063 1.031v6.594h-4.031c-0.531 0-0.719 0.344-0.313 0.75l6.688 6.656c0.188 0.188 0.438 0.281 0.719 0.281s0.563-0.094 0.75-0.281l6.656-6.656c0.375-0.406 0.25-0.75-0.313-0.75zM0 18.344v7.125c0 0.313 0.156 0.5 0.5 0.5h21.375c0.344 0 0.531-0.188 0.531-0.5v-7.125c0-0.313-0.25-0.531-0.531-0.531h-2.031c-0.281 0-0.531 0.25-0.531 0.531v4.531h-16.25v-4.531c0-0.313-0.219-0.531-0.5-0.531h-2.063c-0.281 0-0.5 0.25-0.5 0.531z">
                                    </path> 
                                </svg>
                            </a>

                            {% if user.groups.first.name == 'administrators' %}
                                <a id="deleteReferenceImage">
                                    <svg class="svg-option svg-option--delete deleteCategory" width="20px" height="20px" data-category-id="77" data-deletecategory="">
                                        <use href="#icon-delete"></use>
                                    </svg>
                                </a>
                            {% endif %}
                        </div>
                        
                    </div>
                    
                </div>

                <!-- Imágenes que al ser seleccionadas se mostrarán en el contenedor grande -->
                <div class="container__selector-image">
                    <img id="imagen_1" class="container__image--preview" src="{% if part.imagen_1 %}{{ part.imagen_1.url }}{% else %}{{ default_image }}{% endif %}" alt="img">
                    <img id="imagen_2" class="container__image--preview" src="{% if part.imagen_2 %}{{ part.imagen_2.url }}{% else %}{{ default_image }}{% endif %}" alt="img">
                    <img id="imagen_3" class="container__image--preview" src="{% if part.imagen_3 %}{{ part.imagen_3.url }}{% else %}{{ default_image }}{% endif %}" alt="img">
                    <img id="imagen_4" class="container__image--preview" src="{% if part.imagen_4 %}{{ part.imagen_4.url }}{% else %}{{ default_image }}{% endif %}" alt="img">
                    <img id="imagen_5" class="container__image--preview" src="{% if part.imagen_5 %}{{ part.imagen_5.url }}{% else %}{{ default_image }}{% endif %}" alt="img">
                </div>

            </div>       
            <div class="container__section-details">
                <div class="container__section-detail">
                    <span class="detail__label">Nombre:</span>
                    <span class="detail__value">{{part.nombre}}</span>
                </div>
            </div>    
            <div class="container__section-details">
                <div class="container__section-detail">
                    <span class="detail__label">Numero de parte:</span>
                    <span class="detail__value">{{part.num_parte_pk}}</span>
                </div>
            </div>
            <div class="container__section-details">
                <div class="container__section-detail">
                    <span class="detail__label">Ubicacion:</span>
                    <span class="detail__value">{{part.ubicacion}}</span>
                </div>
            </div>
            <div class="container__section-details">
                <div class="container__section-detail">
                    <span class="detail__label">Ingresos:</span>
                    <span class="detail__value">{{partsIncome}}</span>
                </div>
            </div>
            <div class="container__section-details">
                <div class="container__section-detail">
                    <span class="detail__label">Egresos:</span>
                    <span class="detail__value">{{partsOutcome}}</span>
                </div>
            </div>
            <div class="container__section-details">
                <div class="container__section-detail">
                    <span class="detail__label">Cantidad:</span>
                    <span class="detail__value">{{part.total_unidades}}</span>
                </div>
            </div>
        </div>
    </div>


    <div class="page__equipment-section-nav">
        <div class="container--sub-navegation">
            <div class="button button--active button--navegation" id="detailsEquipment" data-target="generalData,technicalSheet">
                <svg fill="currentColor" width="20px" height="20px" viewBox="0 0 32 32">
                    <path d="m16 0c8.836556 0 16 7.163444 16 16s-7.163444 16-16 16-16-7.163444-16-16 7.163444-16 16-16zm0 2c-7.7319865 0-14 6.2680135-14 14s6.2680135 14 14 14 14-6.2680135 14-14-6.2680135-14-14-14zm1.3 18.5v2.6h-2.6v-2.6zm-1.3-11.5c2.209139 0 4 1.790861 4 4 0 1.8636009-1.2744465 3.4295388-2.9993376 3.873812l-.0006624 2.126188h-2v-4h1c1.1045695 0 2-.8954305 2-2s-.8954305-2-2-2c-1.0543618 0-1.9181651.8158778-1.9945143 1.8507377l-.0054857.1492623h-2c0-2.209139 1.790861-4 4-4z" />
                </svg>
                <span>Detalles</span>
            </div>
            <div class="button button--navegation button-margin-left" id="referencesEquipment" data-target="stock">
                <svg viewBox="0 0 24 24" width="20px" height="20px" fill="currentColor">
                    <path d="M5.01112 11.5747L6.29288 10.2929C6.68341 9.90236 7.31657 9.90236 7.7071 10.2929C8.09762 10.6834 8.09762 11.3166 7.7071 11.7071L4.7071 14.7071C4.51956 14.8946 4.26521 15 3.99999 15C3.73477 15 3.48042 14.8946 3.29288 14.7071L0.292884 11.7071C-0.0976406 11.3166 -0.0976406 10.6834 0.292884 10.2929C0.683408 9.90236 1.31657 9.90236 1.7071 10.2929L3.0081 11.5939C3.22117 6.25933 7.61317 2 13 2C18.5229 2 23 6.47715 23 12C23 17.5228 18.5229 22 13 22C9.85817 22 7.05429 20.5499 5.22263 18.2864C4.87522 17.8571 4.94163 17.2274 5.37096 16.88C5.80028 16.5326 6.42996 16.599 6.77737 17.0283C8.24562 18.8427 10.4873 20 13 20C17.4183 20 21 16.4183 21 12C21 7.58172 17.4183 4 13 4C8.72441 4 5.23221 7.35412 5.01112 11.5747ZM13 5C13.5523 5 14 5.44772 14 6V11.5858L16.7071 14.2929C17.0976 14.6834 17.0976 15.3166 16.7071 15.7071C16.3166 16.0976 15.6834 16.0976 15.2929 15.7071L12.2929 12.7071C12.1054 12.5196 12 12.2652 12 12V6C12 5.44772 12.4477 5 13 5Z"></path> 
                </svg>
                <span>Historico</span>
            </div>
        </div>

        <div id="generalData" class="container--activity scroll" style="display: block;">
            <div class="container__section-title">
                <span>Movimientos</span>
            </div>

            <form class="container__form" id="partEditForm">
                {% csrf_token %}

                <div class="form__largue ">
                    <div class="input-container">
                        <div class="input-wrapper input-wrapper--largue">
                            <input class="input input--medium" type="text" id="namePart" name="namePart" value="{{part.nombre}}">
                            <label class="input-container__label" for="namePart">Nombre</label>
                        </div>
                    </div>
                </div>

                <div class="form__largue form__largue--margin-top">
                    <div class="input-container">
                        <div class="input-wrapper">
                            <input class="input input--medium" type="text" id="numberPart" name="numberPart" value="{{part.num_parte_pk}}" readonly>
                            <label class="input-container__label" for="numberPart">Numero de parte</label>
                        </div>
                        <div class="input-wrapper">
                            <input class="input input--medium" type="text" value="{{part.ubicacion}}" name="location" id="location" {% if user.groups.first.name == 'consultants' %}readonly{%endif%} required>
                            <label class="input-container__label" for="location">Ubicacion</label>
                        </div>
                    </div>
                </div>

                <div class="form__auto form__largue--margin-top">
                    <div class="input-container">
                        <div class="input-wrapper input-wrapper--largue">
                            <input class="input input--largue" type="text" id="url" maxlength="1000" name="url" value="{{part.link_consulta}}" {% if user.groups.first.name == 'consultants' %}readonly{%endif%}>
                            <label class="input-container__label" for="url">URL consulta</label>
                        </div>
                    </div>
                </div>

                {% if user.groups.first.name == 'administrators' %}
                    <button class="button button--save">
                        <span>Guardar cambios</span>
                    </button>
                {% endif %}
                <span id="partEditMessageError" class="login__error-message">‎</span>
            </form>
        </div>

        <div id="technicalSheet" class="container--activity scroll" style="display: none;">
            <form class="container__section-title container__section-title--button">
                <div class="container__section-title">
                    <span>Manual</span>
                </div>
                <div class="button button--edit button--input">
                    {% if user.groups.first.name == 'administrators' %}
                        <label class="custom-file-upload pointer" for="partFileSheetInput">
                            Seleccionar archivo
                            <input id="partFileSheetInput" class="file-upload" type="file"
                                data-app="partsInventory"
                                data-table="inventario"
                                data-field="manual"
                                data-type="file"
                                data-record="{{part.num_parte_pk}}">
                        </label>
                    {% endif %}
                </div>
            </form>

            <div class="container__technical-sheet">
                {% if part.manual %}
                    <embed src="{{ part.manual.url }}" type="application/pdf" width="100%" height="600px">
                {% else %}
                    <span>No se encontró ningún documento</span>
                {% endif %}
            </div>
        </div>

        <div id="stock" class="container--activity scroll" style="display: none;">
            <div class="container__section-title">
                <span>Lista de existencias</span>
            </div>
            <div class="container__table">
                <div class="container--large container--sub-table">
                    <table class="table">
                        <div class="table__info table__info--options table__info--gap">
                            <div class="select select--filter select--active">
                                <div class="select__selected" id="filterMovements">Filtrar por</div>
                                <div class="select__options scroll">
                                    <div class="select__option select__option--filter">Entradas</div>
                                    <div class="select__option select__option--filter">Salidas</div>
                                </div>
                                <div class="select__icon">
                                    <svg width="20px" height="20px" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M6.34292 7.75734L4.92871 9.17155L11.9998 16.2426L19.0708 9.17158L17.6566 7.75737L11.9998 13.4142L6.34292 7.75734Z"></path>
                                    </svg>
                                </div>
                            </div>

                            {% if user.groups.first.name == 'administrators' %}
                                <div class="button button--right button--part" data-modal-id="modalAdd">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M20 3L22 7V20C22 20.5523 21.5523 21 21 21H3C2.44772 21 2 20.5523 2 20V7.00353L4 3H20ZM20 9H4V19H20V9ZM13 10V14H16L12 18L8 14H11V10H13ZM18.7639 5H5.23656L4.23744 7H19.7639L18.7639 5Z"></path>
                                    </svg>
                                    <span>Actualizar</span>
                                </div>
                            {% endif %}
                        </div>
                        <thead class="table__headed">
                            <th class="table__headed-title">Movimiento</th>
                            <th class="table__headed-title">Fuente</th>
                            <th class="table__headed-title">Cantidad</th>
                            <th class="table__headed-title table__headed-actions">
                                Acciones
                            </th>
                        </thead>
                        <tbody class="table__body">
                            {% include 'partials/_movements_table_body.html' %}
                        </tbody>
                    </table>
                    <div class="table__footer">
                        {% include 'partials/_movements_table_footer.html' %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% if user.groups.first.name == 'administrators' %}
    <div class="modal-overlay"></div>


    <div class="modal" id="modalAdd">
        <button class="modal__close">
            <svg width="20px" height="20px" viewBox="0 0 24 24" fill="currentColor">
                <path id="Vector" d="M18 18L12 12M12 12L6 6M12 12L18 6M12 12L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>

        <div class="modal__header">
            <span>Añadir existencia</span>
            <p class="modal__subheader">Por favor, ingresa los datos necesarios para registrar la actualizacion.</p>
        </div>


        <form class="container__form" id="addPartForm">
            {% csrf_token %}
            <input class="input input--largue" type="text" value="{{reference.referencia_pk}}" name="reference" hidden>
            
            <div class="form__largue form__largue--margin-top">
                <div class="input-container">
                    <div class="input-wrapper">
                        <input class="input input--medium" maxlength="100" type="text" id="source" name="source" required>
                        <label class="input-container__label" for="source">Fuente</label>
                    </div>
                    
                        <div class="input-wrapper input-wrapper--flex">
                            <div class="select select--filter select--state">
                                <div class="select__selected select__selected--action">Accion</div>
                                <div class="select__options scroll">
                                    <div class="select__option">Añadir</div>
                                    <div class="select__option">Sustraer</div>
                                </div>
                                <div class="select__icon">
                                    <svg width="20px" height="20px" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M6.34292 7.75734L4.92871 9.17155L11.9998 16.2426L19.0708 9.17158L17.6566 7.75737L11.9998 13.4142L6.34292 7.75734Z"></path>
                                    </svg>
                                </div>
                            </div>
                            <div class="input-wrapper">
                                <input class="input input--medium" type="number" id="amount" name="amount" required>
                                <label class="input-container__label" for="amount">Cantidad</label>
                            </div>
                        </div>
                </div>
            </div>
            <div class="form__largue form__largue--margin-top">
                <div class="input-container">
                    <div class="input-wrapper input-wrapper--largue">
                        <textarea class="input input--largue textarea" id="note" name="note" maxlength="250" style="height: 45px;"></textarea>
                        <label class="input-container__label textarea__label" for="note">Observaciones</label>
                    </div>
                </div>
            </div>


            <div class="modal__options">
                <button type="submit" class="button button--save">
                    <span>Añadir</span>
                </button>
                <span id="messageAddError" class="login__error-message">‎</span>
            </div>

        </form>
    </div>

{% endif %}

<div class="modal modal--parts" id="modalMovements">
    <button class="modal__close">
        <svg width="20px" height="20px" viewBox="0 0 24 24" fill="currentColor">
            <path id="Vector" d="M18 18L12 12M12 12L6 6M12 12L18 6M12 12L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
        </svg>
    </button>

    <div class="modal__header">
        <span>Registro <span id="movemenAction"></span> de partes</span>
    </div>
    
    <div class="modal__text modal__text--margin-top">
        <span class="modal__text-general">
            <span class="modal__text-label">Fecha:</span>
            <span class="modal__text-value" id="movemenDate"></span>
        </span>
        <span class="modal__text-general">
            <span class="modal__text-label">Fuente:</span>
            <span class="modal__text-value" id="movementSource"></span>
        </span>
        <span class="modal__text-general">
            <span class="modal__text-label">Cantidad:</span>
            <span class="modal__text-value" id="movementQuantity"></span>
        </span>
        <span class="modal__text-general">
            <span class="modal__text-label">Observaciones:</span>
            <span class="modal__text-value" id="movementObservations"></span>
        </span>
    </div>
    
</div>

<script src="{% static 'js/tooltip.js' %}"></script>
<script src="{% static 'js/modal_movements.js' %} ?v=2"></script>
<script src="{% static 'js/searchs_tables.js' %} ?v=2"></script>
<script src="{% static 'js/part_crud.js' %} ?v=2" ></script>
<script src="{% static 'js/inserts_crud.js' %} ?v=2"></script>
<script src="{% static 'js/inputs_placeholders.js' %}"></script>
<script src="{% static 'js/height_textarea.js' %}"></script>
<script src="{% static 'js/images_equipment.js' %} ?v=2" ></script>
<script src="{% static 'js/sub_navigation.js' %} ?v=2"></script>
<script src="{% static 'js/update_files.js' %} ?v=2"></script>
<script src="{% static 'js/download_file.js' %} ?V=2" ></script>
<script src="{% static 'js/filter_selector.js' %}"></script>
<script src="{% static 'js/modal.js' %}"></script>



{% endblock %}

